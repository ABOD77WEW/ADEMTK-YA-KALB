<div class="min-h-screen bg-gradient-to-b from-[#1a1a1a] via-[#2c2c2c] to-[#1a1a1a] text-[#f0e6d2] p-4 sm:p-8">
  <div class="max-w-4xl mx-auto relative">

    <!-- Credits -->
    <div class="fixed top-4 left-4 z-[110] p-3 bg-[#2c2c2c]/50 border border-[#c9a969]/50 rounded-lg shadow-md animate-glow-pulse flex flex-col items-start gap-1">
      <p class="text-base text-[#fce5ad] font-bold mb-1">إعداد وتصميم</p>
      <p class="text-sm text-[#fce5ad]/90 whitespace-nowrap">عبدالله عامر الشبلي</p>
      <p class="text-sm text-[#fce5ad]/90 whitespace-nowrap">عمار نادر النعيمي</p>
    </div>

    <!-- Header Section -->
    <header class="text-center py-12 border-b-2 border-[#c9a969]/30 fade-in-up">
      <h1 class="font-amiri text-5xl sm:text-7xl font-bold title-fiery-gold">
        ع<span class="diacritic-gold">َ</span>د<span class="diacritic-gold">ِ</span>م<span class="diacritic-gold">ْ</span>ت<span class="diacritic-gold">ُ</span>ك<span class="diacritic-gold">َ</span> ي<span class="diacritic-gold">َ</span>ا ق<span class="diacritic-gold">َ</span>ل<span class="diacritic-gold">ْ</span>ب<span class="diacritic-gold">ُ</span>
      </h1>
      <p class="mt-4 text-2xl text-[#f0e6d2]/80">{{ poet.name }}</p>
    </header>

    <!-- Tabs Navigation -->
    <nav class="my-8 flex justify-center items-center border border-[#c9a969]/30 rounded-lg p-1 bg-[#2c2c2c]/30 fade-in-up" style="animation-delay: 0.1s;">
      <button (click)="setActiveTab('introduction')" 
              [class]="activeTab() === 'introduction' ? 'bg-[#c9a969] text-[#1a1a1a]' : 'hover:bg-white/10'"
              class="flex-1 font-bold py-3 px-4 rounded-md transition-all duration-300">
        التمهيد
      </button>
      <button (click)="setActiveTab('poet')" 
              [class]="activeTab() === 'poet' ? 'bg-[#c9a969] text-[#1a1a1a]' : 'hover:bg-white/10'"
              class="flex-1 font-bold py-3 px-4 rounded-md transition-all duration-300">
        التعريف بالشاعر
      </button>
      <button (click)="setActiveTab('poem')" 
              [class]="activeTab() === 'poem' ? 'bg-[#c9a969] text-[#1a1a1a]' : 'hover:bg-white/10'"
              class="flex-1 font-bold py-3 px-4 rounded-md transition-all duration-300">
        القصيدة
      </button>
      <button (click)="setActiveTab('glossary')" 
              [class]="activeTab() === 'glossary' ? 'bg-[#c9a969] text-[#1a1a1a]' : 'hover:bg-white/10'"
              class="flex-1 font-bold py-3 px-4 rounded-md transition-all duration-300">
        معجم المفردات
      </button>
      <button (click)="setActiveTab('summary')" 
              [class]="activeTab() === 'summary' ? 'bg-[#c9a969] text-[#1a1a1a]' : 'hover:bg-white/10'"
              class="flex-1 font-bold py-3 px-4 rounded-md transition-all duration-300">
        الملخص
      </button>
    </nav>

    <main class="mt-12">
      
      <!-- Introduction Tab Content -->
      @if (activeTab() === 'introduction') {
        <section class="fade-in-up">
          <div (click)="openCardModal(introductionCardData)"
               class="card-ornate p-6 cursor-pointer">
            <h2 class="font-amiri text-3xl font-bold text-[#fce5ad] mb-4">{{ introduction.title }}</h2>
            <p class="text-lg leading-relaxed text-[#f0e6d2]/90">
              {{ introduction.content }}
            </p>
            <div class="mt-6 border-t border-[#c9a969]/30 pt-4">
              <blockquote class="text-md italic text-[#f0e6d2]/80 border-r-4 border-[#c9a969] pr-4">
                "{{ introduction.quote }}"
              </blockquote>
              <p class="text-left text-sm mt-2 text-[#c9a969]">- {{ introduction.quoteSource }}</p>
            </div>
          </div>
        </section>
      }

      <!-- Poet Info Tab Content -->
      @if (activeTab() === 'poet') {
        <section class="fade-in-up">
          <div (click)="openCardModal(poetCardData)"
               class="card-ornate p-6 sm:p-8 flex flex-col md:flex-row items-center gap-8 cursor-pointer">
            <div class="flex-shrink-0 flex items-center justify-center w-48 h-48 rounded-full bg-gradient-to-br from-[#2c2c2c] to-[#1a1a1a] border-4 border-[#c9a969] shadow-inner">
              <h2 class="font-amiri text-4xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-b from-[#c9a969] via-[#f0e6d2] to-[#c9a969]" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">
                ب<span class="text-black">َ</span>ش<span class="text-black">َّ</span>ار<span class="text-black">ُ</span><br>بن<span class="text-black">ُ</span><br>ب<span class="text-black">ُ</span>ر<span class="text-black">ْ</span>د<span class="text-black">ٍ</span>
              </h2>
            </div>
            <div class="flex-1 text-center md:text-right">
              <h2 class="font-amiri text-3xl font-bold text-[#fce5ad] mb-4">التعريف بالشاعر</h2>
              <p class="text-lg leading-relaxed text-[#f0e6d2]/90">
               {{ poet.bio }}
              </p>
               <p class="text-left text-sm mt-4 text-[#c9a969]">ديوان بشار بن برد, "دار صادر" بيروت ط.١ ٢٠٠٠</p>
            </div>
          </div>
        </section>
      }

      <!-- Poem Tab Content -->
      @if (activeTab() === 'poem') {
        <section class="fade-in-up">
          <h2 class="font-amiri text-4xl text-center font-bold text-[#fce5ad] mb-8">النص</h2>
          <div class="font-amiri text-xl sm:text-2xl space-y-8 bg-[#2c2c2c]/30 p-6 sm:p-10 rounded-lg border border-[#c9a969]/20">
            @for (verse of poem; track $index) {
              <div>
                <div class="text-center text-[#c9a969] text-sm mb-3">البيت {{ $index + 1 }}</div>
                <div class="grid grid-cols-2 gap-4 verse-line cursor-pointer" (click)="openVerseViewer($index)">
                  <p class="text-right">
                    @for (part of getHighlightedVersePart(verse.part1); track $index) {
                      @if (isObject(part)) {
                        <span class="relative has-glossary cursor-pointer text-[#fce5ad] font-bold">
                          {{ part.word }}
                          <span class="glossary-tooltip absolute bottom-full right-1/2 translate-x-1/2 mb-2 w-48 p-2 bg-[#1a1a1a] border border-[#c9a969] rounded-md shadow-lg text-sm font-normal text-white z-10">
                            {{ part.def }}
                          </span>
                        </span>
                      } @else {
                        <span>{{ part }}</span>
                      }
                    }
                  </p>
                  <p class="text-left">
                    @for (part of getHighlightedVersePart(verse.part2); track $index) {
                      @if (isObject(part)) {
                        <span class="relative has-glossary cursor-pointer text-[#fce5ad] font-bold">
                          {{ part.word }}
                          <span class="glossary-tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-[#1a1a1a] border border-[#c9a969] rounded-md shadow-lg text-sm font-normal text-white z-10">
                            {{ part.def }}
                          </span>
                        </span>
                      } @else {
                        <span>{{ part }}</span>
                      }
                    }
                  </p>
                </div>
              </div>
            }
          </div>
          <p class="text-xs text-center mt-4 text-[#f0e6d2]/60">مرر الفأرة فوق الكلمات الملونة لمعرفة معناها. اضغط على أي بيت لعرضه بشكل مكبر.</p>
        </section>
      }

      <!-- Summary Tab Content -->
      @if (activeTab() === 'summary') {
        <section class="fade-in-up">
          <div class="bg-[#2c2c2c]/50 p-6 sm:p-8 rounded-lg border border-[#c9a969]/50 shadow-lg space-y-8">
            <h2 class="font-amiri text-4xl font-bold text-[#fce5ad] mb-4 text-center">{{ summary.title }}</h2>
            
            <!-- Poet Summary -->
            <div class="border-b-2 border-[#c9a969]/20 pb-6">
              <h3 class="font-amiri text-2xl font-bold text-[#c9a969] mb-3">نبذة عن الشاعر</h3>
              <p class="text-lg text-[#f0e6d2]/90">{{ summary.poetSummary }}</p>
            </div>

            <!-- General Idea -->
            <div class="border-b-2 border-[#c9a969]/20 pb-6">
              <h3 class="font-amiri text-2xl font-bold text-[#c9a969] mb-3">الفكرة العامة</h3>
              <p class="text-lg text-[#f0e6d2]/90">{{ summary.generalIdea }}</p>
            </div>

            <!-- Detailed Ideas -->
            <div class="border-b-2 border-[#c9a969]/20 pb-6">
              <h3 class="font-amiri text-2xl font-bold text-[#c9a969] mb-4">الأفكار الجزئية</h3>
              <ul class="space-y-4">
                @for(item of summary.detailedIdeas; track item.title) {
                  <li>
                    <strong class="font-bold text-[#fce5ad]">{{ item.title }}:</strong>
                    <span class="text-[#f0e6d2]/90"> {{ item.content }}</span>
                  </li>
                }
              </ul>
            </div>

            <!-- Artistic Features -->
            <div class="border-b-2 border-[#c9a969]/20 pb-6">
              <h3 class="font-amiri text-2xl font-bold text-[#c9a969] mb-4">الجماليات والسمات الفنية</h3>
              <ul class="space-y-4">
                @for(item of summary.artisticFeatures; track item.feature) {
                  <li>
                    <strong class="font-bold text-[#fce5ad]">{{ item.feature }}:</strong>
                    <span class="text-[#f0e6d2]/90"> {{ item.explanation }}</span>
                  </li>
                }
              </ul>
            </div>

            <!-- Vocabulary -->
            <div>
              <h3 class="font-amiri text-2xl font-bold text-[#c9a969] mb-4">أبرز المفردات</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3">
                @for(item of summary.vocabulary; track item.word) {
                  <div class="flex justify-between border-b border-white/10 py-1">
                    <strong class="font-bold text-[#fce5ad]">{{ item.word }}</strong>
                    <span class="text-[#f0e6d2]/90">{{ item.definition }}</span>
                  </div>
                }
              </div>
            </div>
          </div>
        </section>
      }

      <!-- Glossary Tab Content -->
      @if (activeTab() === 'glossary') {
        <section class="fade-in-up">
          <h2 class="font-amiri text-4xl text-center font-bold text-[#fce5ad] mb-8">معجم المفردات</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            @for (term of glossary; track term.term) {
              <div (click)="openCardModal({ title: term.term, content: term.definition })"
                   class="glossary-card p-5 rounded-lg cursor-pointer">
                <h3 class="text-[#fce5ad] font-bold text-xl font-amiri">{{ term.term }}</h3>
                <p class="text-[#f0e6d2]/90 mt-1">{{ term.definition }}</p>
              </div>
            }
          </div>
        </section>
      }

    </main>

    <!-- Quiz Floating Action Button -->
    <div class="fixed bottom-8 left-8 z-50">
      <div class="absolute bottom-full mb-3 left-1/2 -translate-x-1/2 w-auto">
        <div class="bg-red-700 border-2 border-red-900 text-white font-bold py-2 px-6 rounded-lg shadow-lg select-none"
             style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5); box-shadow: 0 4px 6px rgba(0,0,0,0.4), inset 0 2px 2px rgba(255,255,255,0.2), inset 0 -2px 2px rgba(0,0,0,0.3);">
          الأسئلة
        </div>
      </div>
      <button (click)="openQuiz()" class="relative w-20 h-20 bg-gradient-to-br from-[#fce5ad] to-[#c9a969] rounded-full shadow-lg text-[#1a1a1a] flex items-center justify-center transform hover:scale-110 transition-transform duration-300">
        <span class="absolute inline-flex h-full w-full rounded-full bg-[#fce5ad] animate-spaced-ping"></span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
      </button>
    </div>

  </div>
</div>

<!-- Quiz Fullscreen View -->
@if (quizModalVisible()) {
  <div class="fixed inset-0 z-50 animate-fadeInUp overflow-y-auto quiz-bg">
    <div class="w-full max-w-4xl mx-auto p-4 sm:p-8 flex flex-col min-h-screen justify-center">
      <div class="relative">
        
        @if (!quizFinished()) {
          <div>
            <!-- Header -->
            <div class="px-6 pb-6">
              <div class="flex justify-between items-center mb-6">
                 <div class="flex items-center gap-4">
                    <h2 class="text-3xl sm:text-4xl font-bold font-amiri text-[#fce5ad]">اختبر معلوماتك!</h2>
                 </div>
                <button (click)="closeQuiz()" class="text-4xl text-[#f0e6d2]/70 hover:text-white transition-colors">&times;</button>
              </div>
              <div class="flex items-center gap-4 text-sm text-[#f0e6d2]/80">
                <span>السؤال {{ currentQuestionIndex() + 1 }} / {{ quizQuestions.length }}</span>
                <div class="w-full bg-black/30 rounded-full h-3 shadow-inner">
                  <div class="bg-gradient-to-r from-[#fce5ad] to-[#c9a969] h-3 rounded-full transition-all duration-500" [style.width.%]="(currentQuestionIndex() + 1) / quizQuestions.length * 100"></div>
                </div>
              </div>
            </div>
            
            <!-- Question Card -->
            <div class="p-6 relative">
              <div class="bg-[#1a1a1a]/70 p-8 rounded-lg border-2 border-[#c9a969]/70 shadow-xl shadow-black/50 relative text-center">
                <div class="absolute -top-2 -left-2 w-8 h-8 border-t-2 border-l-2 border-[#fce5ad] rounded-tl-lg"></div>
                <div class="absolute -top-2 -right-2 w-8 h-8 border-t-2 border-r-2 border-[#fce5ad] rounded-tr-lg"></div>
                <div class="absolute -bottom-2 -left-2 w-8 h-8 border-b-2 border-l-2 border-[#fce5ad] rounded-bl-lg"></div>
                <div class="absolute -bottom-2 -right-2 w-8 h-8 border-b-2 border-r-2 border-[#fce5ad] rounded-br-lg"></div>

                <p class="text-2xl sm:text-3xl leading-relaxed font-amiri min-h-24 flex items-center justify-center text-[#f0e6d2]">
                  {{ quizQuestions[currentQuestionIndex()].question }}
                </p>
              </div>
            </div>

            <!-- Options -->
            <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
              @for (option of quizQuestions[currentQuestionIndex()].options; track $index) {
                <button
                  (click)="selectAnswer(option)"
                  [disabled]="selectedAnswer() !== null"
                  [class]="getOptionClass(option)"
                  class="quiz-option w-full text-right p-4 rounded-lg transition-all duration-300 disabled:cursor-not-allowed text-lg relative overflow-hidden group">
                  <span class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-[#fce5ad]/20 to-transparent -translate-x-full group-hover:translate-x-0 transition-transform duration-500 ease-out"></span>
                  <span class="relative z-10">{{ option }}</span>
                </button>
              }
            </div>
            
             <div class="mt-4 flex justify-center">
                <button (click)="openWheel()" 
                        class="flex items-center gap-3 px-5 py-3 rounded-full border border-[#c9a969]/50 bg-[#2c2c2c]/50 hover:bg-[#c9a969] hover:text-[#1a1a1a] transition-all duration-300 group shadow-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-[#fce5ad] transition-transform group-hover:text-[#1a1a1a] group-hover:rotate-90 duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" stroke-opacity="0.7"/>
                    <path d="M12 2v20M2 12h20"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <span class="font-bold text-[#fce5ad] group-hover:text-[#1a1a1a] transition-colors">استخدام العجلة الدوارة</span>
                </button>
              </div>
          </div>
        } @else {
          <div class="flex items-center justify-center min-h-[80vh]">
            <div class="relative text-center p-8 sm:p-12 overflow-hidden">
              @if(showConfetti()) {
                <div class="absolute inset-0 pointer-events-none">
                  @for (i of [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]; track i) {
                    <div class="confetti"></div>
                  }
                </div>
              }
              <div class="relative z-10 animate-result-pop-in">
                <svg class="w-28 h-28 text-[#fce5ad] mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h2 class="text-5xl font-bold font-amiri text-[#fce5ad] mb-4">أحسنت!</h2>
                <p class="text-2xl mb-4 text-[#f0e6d2]">لقد أكملت الاختبار بنجاح.</p>
                <p class="text-7xl font-bold my-8 text-white">{{ score() }} <span class="text-2xl text-[#f0e6d2]/80">/ {{ quizQuestions.length }}</span></p>
                <p class="text-xl mb-10">شكرًا لمشاركتك!</p>
                <button
                  (click)="closeQuiz()"
                  class="px-10 py-4 bg-[#fce5ad] text-[#1a1a1a] font-bold rounded-lg shadow-md hover:bg-white transition-colors text-lg">
                  إغلاق
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}

<!-- Wheel Modal -->
@if (wheelModalVisible()) {
  <div class="fixed inset-0 z-[120] flex items-center justify-center bg-[#1a1a1a]/95 backdrop-blur-sm p-4 animate-fadeInUp">
    <div class="relative w-full max-w-lg mx-auto text-center">
      <button (click)="closeWheel()" class="absolute -top-8 right-0 text-white/70 hover:text-white text-5xl z-[130] transition-colors">&times;</button>
      
      <h2 class="font-amiri text-4xl font-bold text-[#fce5ad] mb-4" style="text-shadow: 1px 1px 3px #000;">العجلة العشوائية</h2>
      
      <div class="relative w-[420px] h-[420px] mx-auto my-8 flex items-center justify-center">
        <!-- Decorative outer rim -->
        <div class="absolute inset-[-15px] rounded-full bg-[#1a1a1a] shadow-[inset_0_0_15px_rgba(252,229,173,0.3),_0_0_20px_rgba(0,0,0,0.7)]"></div>
        <div class="absolute inset-[-10px] rounded-full border-4 border-double border-[#c9a969]/50"></div>
    
        <!-- Pointer -->
        <div class="absolute -top-2 left-1/2 -translate-x-1/2 z-20" style="filter: drop-shadow(0 6px 4px rgba(0,0,0,0.6));">
            <svg width="40" height="50" viewBox="0 0 40 50">
                <path d="M20 50 L0 25 Q20 20 40 25 Z" fill="#4a3f2a"></path>
                <path d="M20 0 L35 25 L5 25 Z" fill="#fce5ad"></path>
                <circle cx="20" cy="25" r="8" fill="#c9a969" stroke="#1a1a1a" stroke-width="2"/>
            </svg>
        </div>

        <!-- Wheel SVG Container -->
        <div class="absolute inset-0" [style.transform]="wheelTransform()" [style.transition]="wheelTransition()">
            <!-- Inner shadow for depth -->
            <div class="absolute inset-0 rounded-full shadow-[inset_0_0_25px_15px_rgba(0,0,0,0.6)] pointer-events-none"></div>
            <svg viewBox="0 0 420 420" class="w-full h-full">
                <defs>
                  <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="3" result="blur"/>
                    <feOffset in="blur" dx="2" dy="2" result="offsetBlur"/>
                    <feMerge>
                      <feMergeNode in="offsetBlur"/>
                      <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                  </filter>
                </defs>
                <g filter="url(#shadow)">
                  @for (segment of wheelSegments(); track segment.number) {
                    <path [attr.d]="segment.path" [attr.fill]="segment.active ? segment.color : '#3a3a3c'" class="transition-colors duration-500" [class.opacity-70]="!segment.active"></path>
                    <text [attr.x]="segment.textX" [attr.y]="segment.textY" [attr.transform]="segment.textTransform" [attr.fill]="segment.active ? '#1a1a1a' : '#a1a1aa'" font-size="16" font-weight="bold" text-anchor="middle" class="pointer-events-none transition-colors duration-500">
                      {{ segment.number }}
                    </text>
                  }
                </g>
              </svg>
        </div>
        
        <!-- Spin Button -->
        <button (click)="spinWheel()" [disabled]="isSpinning() || areAllSegmentsInactive()" 
          class="absolute w-32 h-32 rounded-full z-10 bg-gradient-to-br from-[#3c3c3c] via-[#2c2c2c] to-[#1a1a1a] border-8 border-double border-[#c9a969]
                 flex flex-col items-center justify-center text-[#fce5ad] font-bold text-xl
                 transition-all duration-300 transform hover:scale-110 active:scale-100 disabled:scale-100 disabled:opacity-50 disabled:cursor-not-allowed
                 shadow-[0_0_25px_rgba(252,229,173,0.4)]">
          <span>أدر</span>
          <span>العجلة</span>
        </button>
      </div>

      <div class="h-24 flex flex-col items-center justify-center">
        @if (selectedNumberFromWheel(); as selectedNum) {
          <div class="animate-fadeInScaleUp">
            <p class="text-lg text-[#f0e6d2]/80">الرقم المختار هو:</p>
            <p class="text-7xl font-bold text-white my-2">{{ selectedNum }}</p>
          </div>
        } @else if (areAllSegmentsInactive()) {
           <p class="text-xl text-yellow-400">انتهت جميع الأرقام!</p>
        }
      </div>

      <button (click)="initializeWheel()" class="px-6 py-2 border border-[#c9a969] text-[#c9a969] rounded-full hover:bg-[#c9a969] hover:text-[#1a1a1a] transition-colors duration-300">
        إعادة تعيين
      </button>

    </div>
  </div>
}

<!-- Verse Viewer Modal -->
@if (verseViewerVisible()) {
  <div class="fixed inset-0 z-[100] bg-[#1a1a1a]/95 backdrop-blur-sm flex flex-col items-center justify-center p-4">
    <button (click)="closeVerseViewer()" class="absolute top-6 right-6 text-white/70 hover:text-white text-5xl z-[111] transition-colors">&times;</button>
    
    <div class="w-full h-full overflow-y-auto scroll-smooth snap-y snap-mandatory verse-viewer-container">
      @for (verse of poem; track $index) {
        <div id="verse-{{$index}}" class="h-full w-full flex items-center justify-center snap-start">
            <div class="max-w-5xl w-full text-center p-8">
                <p class="text-xl text-[#c9a969] mb-8">البيت {{ $index + 1 }}</p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-4">
                  <p class="font-amiri text-3xl md:text-5xl leading-loose verse-line text-[#f0e6d2]">{{ poem[$index].part1 }}</p>
                  <p class="font-amiri text-3xl md:text-5xl leading-loose verse-line text-[#f0e6d2]">{{ poem[$index].part2 }}</p>
                </div>

                <div class="mt-12 text-center">
                  <button (click)="toggleExplanation()" class="px-6 py-2 border border-[#c9a969] text-[#c9a969] rounded-full hover:bg-[#c9a969] hover:text-[#1a1a1a] transition-colors duration-300">
                    {{ explanationVisible() ? 'إخفاء الشرح' : 'إظهار الشرح' }}
                  </button>
                </div>

                @if (explanationVisible()) {
                  @let explanation = poem[$index].explanation;
                  <div class="mt-6 text-right bg-[#2c2c2c]/60 border border-[#c9a969]/30 rounded-lg p-6 animate-fadeInUp max-w-4xl mx-auto">
                    <h3 class="font-amiri text-2xl font-bold text-[#fce5ad] mb-4">شرح البيت</h3>
                    <p class="text-lg text-white/90 leading-relaxed">{{ explanation.meaning }}</p>
                    
                    @if (explanation.imagery) {
                      <h4 class="font-amiri text-xl font-bold text-[#fce5ad] mt-6 mb-2">الصور الجمالية</h4>
                      <p class="text-white/80">{{ explanation.imagery }}</p>
                    }

                    @if (explanation.rhetoric) {
                      <h4 class="font-amiri text-xl font-bold text-[#fce5ad] mt-6 mb-2">الأساليب البلاغية</h4>
                      <p class="text-white/80">{{ explanation.rhetoric }}</p>
                    }

                    @if (explanation.vocabulary && explanation.vocabulary.length > 0) {
                      <h4 class="font-amiri text-xl font-bold text-[#fce5ad] mt-6 mb-2">معاني المفردات</h4>
                      <ul class="list-none space-y-2">
                        @for (vocab of explanation.vocabulary; track vocab.word) {
                          <li>
                            <span class="font-bold text-[#fce5ad]">{{ vocab.word }}:</span>
                            <span class="text-white/80"> {{ vocab.definition }}</span>
                          </li>
                        }
                      </ul>
                    }
                  </div>
                }
            </div>
        </div>
      }
    </div>
  </div>
}

<!-- Card Viewer Modal -->
@if (cardModalVisible() && cardModalContent(); as content) {
  <div class="fixed inset-0 z-[100] bg-[#1a1a1a]/95 backdrop-blur-sm p-4 sm:p-8 overflow-y-auto">
    <button (click)="closeCardModal()" class="absolute top-6 right-6 text-white/70 hover:text-white text-5xl z-[111] transition-colors">&times;</button>
    
    <div class="w-full max-w-5xl mx-auto my-8 animate-fadeInUp">
        <div class="text-center">
          <h2 class="font-amiri text-4xl sm:text-6xl font-bold text-[#fce5ad] mb-8">{{ content.title }}</h2>

          @if (content.title === 'التعريف بالشاعر') {
            <div class="flex items-center justify-center w-48 h-48 rounded-full bg-gradient-to-br from-[#2c2c2c] to-[#1a1a1a] border-4 border-[#c9a969] mx-auto my-8 shadow-lg shadow-black/50">
              <h2 class="font-amiri text-4xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-b from-[#c9a969] via-[#f0e6d2] to-[#c9a969]" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">
                ب<span class="text-black">َ</span>ش<span class="text-black">َّ</span>ار<span class="text-black">ُ</span><br>بن<span class="text-black">ُ</span><br>ب<span class="text-black">ُ</span>ر<span class="text-black">ْ</span>د<span class="text-black">ٍ</span>
              </h2>
            </div>
          } @else if (content.imageUrl) {
            <img [src]="content.imageUrl" [alt]="content.title" class="w-40 h-40 rounded-full object-cover border-4 border-[#c9a969] mx-auto my-8 shadow-lg">
          }
        </div>

        <div class="text-right bg-[#2c2c2c]/50 border border-[#c9a969]/30 rounded-lg p-6 sm:p-8">
            <p class="text-xl sm:text-2xl leading-relaxed sm:leading-loose text-[#f0e6d2]/90 whitespace-pre-wrap">{{ content.content }}</p>
        </div>

        @if (content.source) {
          <p class="text-left text-base sm:text-lg mt-6 text-[#c9a969]">- {{ content.source }}</p>
        }
    </div>
  </div>
}